services:
  lab-agent:
    build: .
    container_name: htb-clone-lab-agent
    restart: unless-stopped
    ports:
      - "9000:9000"
    environment:
      LAB_AGENT_CONFIG_FILE: "/etc/lab-agent/config.yaml"
      LAB_AGENT_LISTEN_ADDR: ":9000"
      LAB_AGENT_AUTH_MODE: "hmac"
      LAB_AGENT_HMAC_SECRET: "change-me-hmac"
      LAB_AGENT_STATE_FILE: "/var/lib/lab-agent/state.json"
      LAB_AGENT_WG_MODE: "mock"
      LAB_AGENT_IMAGE_ALLOW_PREFIXES: "ghcr.io/csai/labs/"
      FLAG_SECRET: "change-me-flag"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./data:/var/lib/lab-agent
      - ./configs/agent.example.yaml:/etc/lab-agent/config.yaml:ro
